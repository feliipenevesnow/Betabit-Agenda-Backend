# C:\laragon\www\agenda-api\docker-compose.yml
version: '3.8'

services:
  # Serviço 1: PHP-FPM (Sua aplicação Laravel)
  app:
    # Usa o Dockerfile que está no diretório atual
    build:
      context: .
      dockerfile: Dockerfile
    
    # Mapeamento de volumes para desenvolvimento local
    volumes:
      - .:/app
    
    # Variáveis de ambiente
    env_file:
      - .env # Carrega variáveis do seu .env local
    
    # PHP-FPM roda na porta 9000 (padrão da imagem Alpine)
    expose:
      - 9000

  # Serviço 2: Nginx (Servidor Web para acessar via HTTP)
  nginx:
    image: nginx:stable-alpine
    
    # Mapeia a porta 80 do contêiner Nginx para a porta 8000 do seu host (http://localhost:8000)
    ports:
      - "8000:80"
    
    # Mapeia os arquivos do projeto e a configuração do Nginx
    volumes:
      - .:/app
      - ./docker/nginx/conf.d:/etc/nginx/conf.d:ro # Configuração do Nginx
    
    depends_on:
      - app # Garante que o PHP-FPM (app) inicie antes do Nginx